var VocS = [
    "The clerk behind the counter smiled at the customer.",
    "He countered that he was only following procedures.",
    "He countered with a right hook.",
    "I admit it is hard to listen to counter opinions.",
    "Though the outcome runs/goes counter to my expectation, I am still optimistic.",
    "The clock in the painting is a symbolic representation of the passage of time.",
    "You are very fortunate to have a friend like him.",
    "Fortunately, we got home before the rush hour.",
    "It was unfortunate that no one liked his new play.",
    "Friendship in misfortune lasts forever.",
    "Columbus returned home in triumph after he had reached India.",
    "Good will eventually triumph over evil.",
    "The whole city poured out for their triumphant homecoming.",
    "After the game, I felt exhausted, but also triumphant.",
    "There is no mutual trust between us.",
    "They finally reached a mutually agreed decision. ",
    "The world changed rapidly after the invention of the computer.",
    "What do you think is the most important invention of this century?",
    "The desk can be adapted to the height of the user.",
    "Children adapt themselves to new environments faster than adults.",
    "The book has been adapted for stage.",
    "The film is adapted from a science fiction novel.",
    "The novel has been adapted into a television series.",
    "I corresponded with my son when he studied in boarding school.",
    "The color of the real thing doesn't correspond with that of the sample.",
    "My hometown has scarcely changed for the last thirty years.",
    "Scarcity makes things valuable, while abundance makes things worthless.",
    "The man wishes to get a divorce from his wife.",
    "Her parents divorced after she was born.",
    "I want to divorce you.",
    "The divorced couple later became good friends.",
    "Students register for the new semester at the beginning of September.",
    "Mr. Wang registered the new house in his wife's name.",
    "You had better register this important letter.",
    "Guests write down their names in the hotel register.",
    "The robber forced the clerk to hand him all the money in the cash register.",
    "The registration of students for the course starts next Monday.",
    "The soldier received a reward for saving the king's daughter. ",
    "I will grant you three wishes in reward for your kindness.",
    "I felt I should reward her for her efforts.",
    "Teaching is a rewarding job.",
    "When the Roman Empire ended is up for debate.",
    "The man slowly turned his gaze to me.",
    "I like to gaze at the stars in the night sky.",
    "Korean teams always play in an aggressive style.",
    "You need to be more aggressive in marketing.",
    "Oxygen and hydrogen are both gases.",
    "Water is made up of oxygen and hydrogen.",
    "Those with a hatred of evil are fit to be policemen.",
    "FedEx is an international carrier.",
    "They tried to hit the enemy's carriers but failed.",
    "They are carriers of the lung disease, TB.",
    "For convenience, I moved to an apartment near the station.",
    "For me, a smartphone is a convenience, not a necessity.",
    "Taiwan Power Company apologized for the inconvenience caused by the power failure.",
    "Not having a cellphone will cause many inconveniences for modern people.",
    "To our great delight, our team won the game.",
    "Her performance delighted everyone in the house.",
    "Thank you for a delightful evening.",
    "We were all delighted to hear of the news of Victory.",
    "The dishes are all in the kitchen cabinet.",
    "The cabinet will be reshuffled soon.",
    "Many of our students do voluntary work in hospitals.",
    "These young men joined the military voluntarily.",
    "Employment insurance covers involuntary unemployment.",
    "He works as a volunteer to help deliver meals to the elderly.",
    "Those teachers volunteer to teach in the poorest rural schools.",
    "I volunteered for this activity.",
    "I volunteered to participate in this activity.",
    "There were lively New Year celebrations all over the town.",
    "We have a party in celebration of Women's Day.",
    "The two departments have distinct functional differences.",
    "He built a functional artificial intelligence robot.",
    "All the rooms facing the ocean have splendid views.",
    "It is splendid to have you back.",
    "They should classify the books by subject.",
    "The classification of the books here looks very systematic.",
    "He placed a classified ad in the local newspaper.",
    "WikiLeaks released numerous classified military documents.",
    "I had a major crush on him in high school.",
    "His car was crushed under a truck in the accident.",
    "The riot police crushed the demonstration in the capital.",
    "Allen is one of our most promising students.",
    "The sudden collapse of the tower frightened everyone there.",
    "Mass production resulted in the collapse of prices.",
    "The roof collapsed and crushed all the furniture inside.",
    "His health collapsed after the transplant surgery.",
    "We are striving to become a member of the United Nations.",
    "We have been striving for freedom of speech.",
    "The cruel murderer was sentenced to death.",
    "Einstein was a genius.",
    "She has a genius for music.",
    "A gay's sexual orientation is toward members of the same sex.",
    "There should be an orientation course for all the new employees.",
    "Nobody can violate the law without being punished.",
    "You don't have to worry that we will violate your privacy.",
    "What you did was in violation of our agreement.",
    "The violation of human rights cannot be tolerated.",
    "Sam wants to be a conductor.",
    "Iron is a good conductor of heat.",
    "Hsinchu Science Park is famous for its semiconductor industry.",
    "If it is not treated properly, the condition can be fatal.",
    "The fatality rate of this disease is approximately 2%.",
    "The organization aims at AIDS prevention and education.",
    "Prevention is better than cure.",
    "It is unwise to borrow money to invest in the stock market.",
    "Through careful investments, he made a lot of money.",
    "The government lowers taxes to attract foreign investors.",
    "The penalty for breaking the law is three years in prison.",
    "Some people argue that the death penalty should be abolished.",
    "Japan invaded China in 1937.",
    "The invasion of one's privacy is a serious problem.",
    "The invaders were finally driven out of our territory."
];

var MonthlySC = [
    "Suppose global warming keeps worsening, what would become of the earth?",
    "As long as everyone takes environmental protection as their first priority, the situation can be improved more or less.",
    "I had always been very confident that I would never be conned.",
    "Not until the police contacted me last night did I realize that I was conned.",
    "Internet addiction can do great/considerable damage to one's life.",
    "Once you find that you cannot live without the Internet, you are likely to become addicted to the Internet.",
    "No sooner had Mary got up than she checked her social media, including Facebook and Instagram.",
    "Not until recently has she realized that she has wasted so much time on others' lives.",
    "My younger brother could read when he was three.",
    "By the time he was five, he had read more than 300 story books.",
    "By the end of this year, my bakery will have been opened for three years.",
    "I truly hope that it won't be long before my second shop is opened.",
    "By the end of this September, Eric will have studied abroad for five years.",
    "It will not be long before he gets his doctoral degree.",
    "It has been eight years since the mass rapid transit system was constructed in this city.",
    "It will take another two years for the whole system to start operation."
];

var SentenceP = [
    //#####################
    "A decade ago, people of all ages in Taiwan were suddenly woken by an enormous tremble, and I was no exception.",
    "As soon as I turned on the TV sleepily, the horrible scene instantly dispelled my lethargy, throwing me into deep disbelief and astonishment.",
    "Flesh, blood, limbs, bone and rubble were splattered over the street.",
    "Simultaneously, a majestic skyscraper was collapsing to debris, making the air pervaded by ashes and dusts.",
    "Numerous victims were lying on the ground hopelessly, ghastly, scarlet blood oozing/trickling from appalling wounds.",
    "Worse still, a man writhing in agony shrieked bitterly, \"My mom, my children...\"",
    "His wife also bursting into tears of bereavement tried to calm him down but failed.",
    "Firefighters with shovels hurriedly dug rubble higher than them bravely despite the fact that their effort seemed futile.",
    "Doctors and nurses rushed back and forth anxiously, trying to turn the tide in the life-and-death tug of war, saving patients with no signs of recovery.",
    "If an ignorant traveler passed by the spot, he might be puzzled whether he is visiting Taiwan, or a purgatory.",
    "Somehow, the remote control dropped silently from my shaking hand.",
    "My mom standing next to me knelt down, her face cracking into lines of sorrow.",
    "That was the day Taiwan encountered 921 earthquake tragedy, which is the most unforgettable news event to me.",
    //#####################
    "I used to regard human beings as the most powerful and almighty creature exerting our intelligence and strength to do whatever we want.",
    "Developing amazing technology, constructing lofty buildings and expanding mighty empires with our bare hands seem as easy as ABC.",
    "Nevertheless, I standing in front of nature, viewing the catastrophe resulting from earthquake, notions that how tiny and vulnerable we humans are flash through my mind, compelling me to succumb to the reality - we are nothing but the most fragile creature under the sun.",
    "Recently, owing to rapid development of industry, people emit a large amount of green house gases, causing the irreversible ecological disaster - global warming.",
    "Furthermore, we unscrupulously take whatever we prefer from the Earth, but instead of holding a grateful mind and dancing with nature, we dump trash on mountains, fell trees to meet the demand of paper and discharge contaminated water into the once crystal clean river.",
    "Nowhere is our conscience to be found.",
    "We did something so foul and immoral, no wonder we were seriously punished by nature.",
    //#####################
    "Fortunately, so far, people have realized the significance of environmental protection.",
    "Most of the people turn off lights before leaving the room to conserve redundant electricity, switch off faucets not to waste water, and recycle trash to reduce waste.",
    "Moreover, Taiwan received lots of benevolent donations from four corners of earth.",
    "I was deeply touched by kind acts/deeds from compassionate foreigners, and firmly believed that Taiwan might take the best advantage of these donations in gratitude.",
    //#####################
    "Now, Taiwan is a prosperous island congested with numerous kind-hearted and resilient residents.",
    "Thanks to 921 quake catastrophe/calamity, Taiwanese have transformed into conscientious individuals.",
    "Not only does the event change my mind as arrogant and condescending as a peacock into a brand new humble/modest and grateful/thankful mind, but it also imposes an ethic lesion on every single Taiwanese.",
    "Maybe thirty years later, I might forget most of the knowledge from textbooks, but never will I easily erase the 921 catastrophe/calamity and the education ensuing."
    
];

var list = [
    ["n. 櫃檯", "counter"],
    ["vt. 反駁、回嘴", "counter"],
    ["vi. 還擊、回擊", "counter"],
    ["a. 相反的", "counter"],
    ["adv. 相反地", "counter"],
    ["n. 代表、象徵", "representation"],
    ["vt. 代表", "represent"],
    ["n. 代表性的", "representative"],
    ["n. 代表", "representative"],
    ["a. 幸運的", "fortunate"],
    ["adv. 幸運地", "fortunately"],
    ["a. 不幸的", "unfortunate"],
    ["n. 不幸", "misfortune"],
    ["n. 命運、好運", "fortune"],
    ["n. 勝利、勝利的喜悦", "triumph"],
    ["vi. 戰勝", "triumph"],
    ["a. 勝利的", "triumphant"],
    ["a. 洋洋得意的", "triumphant"],
    ["a. 彼此的、共通的", "mutual"],
    ["adv. 彼此、互相", "mutually"],
    ["n. 發明", "invention"],
    ["n. 發明物", "invention"],
    ["vt. 發明", "invent"],
    ["n. 發明家", "inventor"],
    ["vt. 使適應", "adapt"],
    ["vt. 改編", "adapt"],
    ["phr. 改編自~", "be adapted from"],
    ["phr. 改編成~", "be adapted into"],
    ["vi. 通信", "correspond"],
    ["vi. 與~符合、一致", "correspond"],
    ["adv. 稀少地、幾乎不", "scarcely"],
    ["n. 稀少、罕見", "scarcity"],
    ["a. 缺乏的、不足的、罕見的、珍貴的", "scarce"],
    ["n. 離婚", "divorce"],
    ["vi./vt. 離婚", "divorce"],
    ["a. 離婚的", "divorced"],
    ["vi. 註冊", "register"],
    ["vt. 登記", " register"],
    ["vt. 以掛號寄", "register"],
    ["n. 登記簿、名單", "register"],
    ["n. 收銀機", "cash register"],
    ["n. 登記、註冊", "registration"],
    ["n. 獎賞、報酬", "reward"],
    ["phr. 做為報酬", "in reward"],
    ["vt. 獎賞、報酬", "reward"],
    ["a. 有成就感的、值得做的", " rewarding"],
    ["n. 帝國", "empire"],
    ["n. 帝王", "emperor"],
    ["n. 凝視的目光", "gaze"],
    ["vi. 凝視", "gaze"],
    ["a. 侵略性的、好鬥的", "aggressive"],
    ["a. 積極的、有幹勁的", "aggressive"],
    ["n. 氫氣", "hydrogen"],
    ["n. 氧氣", "oxygen"],
    ["n. 仇恨、憎恨", "hatred"],
    ["vt. 憎恨", "hate"],
    ["n. 恨", "hate"],
    ["a. 可憎的、可恨的、可惡的、充滿憎惡的", "hateful"],
    ["n. 貨運公司", "carrier"],
    ["n. 航空母艦", "carrier"],
    ["n. 帶原者", "carrier"],
    ["n. 便利", "convenience"],
    ["n. 帶來便利的事物", "convenience"],
    ["n. 不便(不可數)", "inconvenience"],
    ["n. 不便之處(可數)", "inconvenience"],
    ["n. 愉悦", "delight"],
    ["vt. 使~愉悅", "delight"],
    ["a. 令人愉悦的", "delightful"],
    ["a. 愉悅的、極為高興的", "delighted"],
    ["n. 櫃子", "cabinet"],
    ["n. 內閣", "cabinet"],
    ["a. 自願的", "voluntary"],
    ["adv. 自願地", "voluntarily"],
    ["a. 非自願的", "involuntary"],
    ["n. 義工、志工、自願者", "volunteer"],
    ["vi./vt. 自願", "volunteer"],
    ["phr. 自願(從事、參加)", "volunteer for N / to V"],
    ["n. 慶祝", "celebration"],
    ["phr. 以慶祝~", "in celebration of"],
    ["a. 功能上的", "functional"],
    ["a. 發揮功能的", "functional"],
    ["a. 壯觀的、華麗的", "splendid"],
    ["a. 絕佳的(口語)", "splendid"],
    ["vt. 分類", "classify"],
    ["n. 分類", "classification"],
    ["a. 分類的", "classified"],
    ["a. 機密的", "classified"],
    ["n. 迷戀、暗戀", "crush"],
    ["vt. 壓碎", "crush"],
    ["vt. 鎮壓", "crush"],
    ["a. 有前途的、有希望的", "promising"],
    ["n. 倒塌、崩潰", "collapse"],
    ["n. 暴跌、崩潰", "collapse"],
    ["vi. 倒塌、崩潰", "collapse"],
    ["vi. 急遽衰退", "collapse"],
    ["vi. 奮力爭取", "strive"],
    ["n. 凶手", "murderer"],
    ["n. 天才", "genius"],
    ["n. 天分、天賦", "genius"],
    ["n. 定位、取向", "orientation"],
    ["n. 職前訓練、新生訓練", "orientation"],
    ["vt. 違反", "violate"],
    ["vt. 侵犯、妨害", "violate"],
    ["n. 違反", "violation"],
    ["n. 侵犯、妨害", "violation"],
    ["n. 指揮家", "conductor"],
    ["n. 導體", "conductor"],
    ["n. 半導體", "semiconductor"],
    ["a. 致命的", "fatal"],
    ["n. 致命", "fatality"],
    ["n. 預防", "prevention"],
    ["vt. 預防", "prevent"],
    ["vi./vt. 投資", "invest"],
    ["n. 投資", "investment"],
    ["n. 投資人", "investor"],
    ["n. 刑罰", "penalty"],
    ["n. 死刑", "death penalty"],
    ["vt. 侵犯、侵略", "invade"],
    ["n. 侵犯、侵略", "invasion"],
    ["n. 侵略者、入侵者", "invader"]
];

var infoContent =
'\
tgfotet v1.5\n\n\n\
tgfotet v1.6 preview is <a href="./prvw6/index.html" style="color: red">here</a>,\n\
with new features.\
\
\
';
// Change logs\n\n\
// v1.5 (Released 29/04/22)\n\
// Added configurations for easier management\n\
// Added tool for phrases\n\n\
// v1.4 (Released 19/03/22)\n\
// Added help tab\n\
// Added change log\n\
// Added session stats\n\n\
// v1.3 (Released 16/03/22)\n\
// Added monthly sc\n\
// Added sentence pattern\n\
// Added menu\n\n\
// v1.2 (Released 12/03/22)\n\
// Added rates tab\n\
// Disabled user from pressing space bar\n\
// Fixed bugs\n\n\
// v1.1 (Released 11/03/22)\n\
// Added style sheets\n\
// Added show answer option\n\n\
// v1.0 (Released 09/03/22)\n\
// First version\n\
// Created domain for tgfotEt\n\n\
var menu_html = '<div class="buttons" id="buttons"><button class="bVoc" id="bVoc" onclick="TobVoc()">Voc Unit 12</button><button class="bMon" id="bMon" onclick="TobMon()">Pattern p164 p171</button><button class="bSeP" id="bSeP" onclick="TobSeP()">Writing</button><button class="bPhr" id="bPhr" onclick="TobPhr()">Translate(U12)</button></div>'
var sentences = [];
var CurrentSentence = 0;
var NofBlanks = [];
var BlanksPosition = [];
var WordsInSentences = [];
var BlankWords = [];
var NofWords = 0;
var SessionCompletedSentences = 0;
var SessionCompletedBlanks = 0;
var session = 1;
var CurrentBlank = 0;
var mode = 0;
var enterskip = 0;
var enterskip2 = 0;
var Successful = 0, Failed = 0;
var Page = "m";
var phr_shownanswer = false;
var disabledSentences = [];
const PMarks = ['.', ',', '!', '?', ';'];
const llist = 1;
var phr_index = 0;

function showinfo(){
    document.getElementById("infocontainer").innerHTML = '<div class="infotab" id="infotab"><div class="infocontent">' + infoContent + '</div></div><button class="hideinfo" id="hideinfo" onclick="hideinfo()">x</button>';
    document.getElementById("info").classList.add("info");
    document.getElementById("info").classList.remove("hide");
}

function hideinfo(){
    document.getElementById("infocontainer").innerHTML = "";
    document.getElementById("info").classList.remove("info");
    document.getElementById("info").classList.add("hide");
}

function showconfig(){
    var configContent = "";
    if(Page=="sv" || Page=="sm" || Page=="sp"){
        const indices = Array.from(sentences.keys()).sort( (a,b) => sentences[a].localeCompare(sentences[b]));
        for(var i = 0; i < sentences.length; i++){
            configContent += makecheckbox(sentences[indices[i]], indices[i], disabledSentences[indices[i]]);
            configContent += '<br><br>';
        }
    }
    else if (Page=="p"){
        const indices = Array.from(list.keys()).sort( (a,b) => list[a][1].localeCompare(list[b][1]));
        for(var i = 0; i < list.length; i++){
            configContent += makecheckbox(list[indices[i]][0] + ' &nbsp ' + list[indices[i]][1], indices[i], disabledSentences[indices[i]]);
            configContent += '<br><br>';
        }
    }
    document.getElementById("configcontainer").innerHTML = '<div class="configtab" id="configtab"><div class="configcontent">' + configContent + '</div></div><button class="hideconfig" id="hideconfig" onclick="hideconfig()">x</button>';
    document.getElementById("config").classList.add("config");
    document.getElementById("config").classList.remove("hide");
}

function hideconfig(){
    document.getElementById("configcontainer").innerHTML = "";
    document.getElementById("config").classList.remove("config");
    document.getElementById("config").classList.add("hide");
    if(Page == 'p'){
        var TotalPhrases = remainingsentences(phr_index) + SessionCompletedSentences;
        document.getElementById("session").innerHTML = 'Session:' + session + ' &nbsp Completed:' + SessionCompletedSentences + '/' + TotalPhrases;
    }
    else{
        var TotalBlanks = remainingblanks() + SessionCompletedBlanks;
        var TotalSentences = remainingsentences(CurrentSentence) + SessionCompletedSentences;
        document.getElementById("session").innerHTML = 'Session:' + session + ' &nbsp Blanks Filled In:' + SessionCompletedBlanks + '/' + TotalBlanks + ' &nbsp Sentences Completed:' + SessionCompletedSentences + '/' + TotalSentences;
    }
}

function TobVoc(){
    document.querySelector("#UI").innerHTML = '<button class="back" id="back" onclick="GoBack()">Back</button><div class="rates" id="rates"></div><div class="session" id="session"></div><div class="sentence" id=sentence><div class="textline" id="textline"></div></div>';
    document.getElementById("configbutton").classList.remove("hide");
    sentences = VocS;
    init(sentences, NofBlanks, BlanksPosition, WordsInSentences, BlankWords);
    display(WordsInSentences, BlanksPosition, CurrentSentence);
    document.getElementById("rates").innerHTML = 'Rates: 0.00%';
    document.getElementById("textbox0").focus();
    Page = "sv";
    disabledSentences = Array(sentences.length).fill(1);
}

function TobMon(){
    document.querySelector("#UI").innerHTML = '<button class="back" id="back" onclick="GoBack()">Back</button><div class="rates" id="rates"></div><div class="session" id="session"></div><div class="sentence" id=sentence><div class="textline" id="textline"></div></div>';
    document.getElementById("configbutton").classList.remove("hide");
    sentences = MonthlySC;
    init(sentences, NofBlanks, BlanksPosition, WordsInSentences, BlankWords);
    display(WordsInSentences, BlanksPosition, CurrentSentence);
    document.getElementById("rates").innerHTML = 'Rates: 0.00%';
    document.getElementById("textbox0").focus();
    Page = "sm";
    disabledSentences = Array(sentences.length).fill(1);
}

function TobSeP(){
    document.querySelector("#UI").innerHTML = '<button class="back" id="back" onclick="GoBack()">Back</button><div class="rates" id="rates"></div><div class="session" id="session"></div><div class="sentence" id=sentence><div class="textline" id="textline"></div></div>';
    document.getElementById("configbutton").classList.remove("hide");
    sentences = SentenceP;
    init(sentences, NofBlanks, BlanksPosition, WordsInSentences, BlankWords);
    display(WordsInSentences, BlanksPosition, CurrentSentence);
    document.getElementById("rates").innerHTML = 'Rates: 0.00%';
    document.getElementById("textbox0").focus();
    Page = "sp";
    disabledSentences = Array(sentences.length).fill(1);
}

function TobPhr(){
    disabledSentences = Array(list.length).fill(llist);
    document.getElementById("configbutton").classList.remove("hide");
    document.querySelector("#UI").innerHTML = '<button class="back" id="back" onclick="GoBack()">Back</button><div class="rates" id="rates"></div><div class="session" id="session"></div><div class="phr-problem" id="phr-problem"><div class="phr" id="phr"></div><textarea class="phr-input" id="phr-input" cols="30" rows="4" maxlength="120" oninput="phr_check()"></textarea></div>';
    shuffle(list, disabledSentences);
    document.getElementById("phr").innerHTML = list[0][0];
    document.getElementById("rates").innerHTML = 'Rates: 0.00%';
    document.getElementById("phr-input").focus();
    document.getElementById("session").innerHTML = 'Session:1 &nbsp Completed:0/' + list.length;
    Page = "p";
}

function GoBack(){
    document.querySelector("#UI").innerHTML = menu_html;
    document.getElementById("configbutton").classList.add("hide");
    if(!document.getElementById("refreshbutton").classList.contains("hide"))
        document.getElementById("refreshbutton").classList.add("hide");
    Page = "m";
    sentences = [];
    NofBlanks = [];
    BlanksPosition = [];
    WordsInSentences = [];
    BlankWords = [];
    CurrentSentence = 0;
    CurrentBlank = 0;
    mode = 0;
    enterskip = 0;
    enterskip2 = 0;
    Successful = 0;
    Failed = 0;
    NofWords = 0;
    SessionCompletedSentences = 0;
    SessionCompletedBlanks = 0;
    session = 1;
    phr_index = 0;
}

function shuffle(array, array2) {
    let currentIndex = array.length,  randomIndex;
    while (currentIndex != 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [
            array[randomIndex], array[currentIndex]];
        [array2[currentIndex], array2[randomIndex]] = [
            array2[randomIndex], array2[currentIndex]];
    }
    return array;
}

function shuffle1(array) {
    let currentIndex = array.length,  randomIndex;
    while (currentIndex != 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [
            array[randomIndex], array[currentIndex]];
    }
    return array;
}

function init(s, n, b, w, bw){
    shuffle(s, disabledSentences);
    NofWords = 0;
    for (let i = 0; i < s.length; i++) {
        var start=0, end=0;
        var words = [];
        for(let j = 0; j < s[i].length; j++){
            if(s[i][j] == " "){
                end = j;
                words.push(s[i].substring(start, end));
                NofWords++;
                start = j + 1;
            }
        }
        words.push(s[i].substring(start));
        NofWords++;
        w.push(words);
    }
    for(let i = 0; i < s.length; i++){
        n.push(Math.round(w[i].length / 8 * 3 + Math.random() * (w[i].length / 4)));
    }
    for(let i = 0; i < s.length; i++){
        var isblank = [];
        for(let j = 0; j < n[i]; j++){
            isblank.push(1);
        }
        for(let j = n[i]; j < w[i].length; j++){
            isblank.push(0);
        }
        shuffle1(isblank);
        b.push(isblank);
    }
    for(let i = 0; i < s.length; i++){
        var sbw = [];
        for(let j = 0; j < w[i].length; j++){
            if(b[i][j] === 1){
                sbw.push([w[i][j], j]);
            }
        }
        bw.push(sbw);
    }
}

function display(w, b, c){
    document.getElementById("textline").innerHTML = "";
    document.getElementById("session").innerHTML = 'Session:1 &nbsp Blanks Filled In:0/' + NofWords + ' &nbsp Sentences Completed:0/' + sentences.length * 2;
    var wclen=w[c].length;
    var blankindex=0;
    for(var i = 0; i < wclen; i++){
        if(b[c][i] == 1){
            var tbl = w[c][i].length;
            if(PMarks.includes(w[c][i][tbl-1])){
                document.getElementById("textline").innerHTML += '<input class="textbox" id="textbox' + blankindex + '" style="width:calc(1.4vmax * ' + (tbl - 1) + ');" maxlength="' + (tbl - 1) + '" autocomplete="off" onkeypress="return event.key != \' \'"></input>' + w[c][i][tbl-1] + ' ';
            }
            else{
                document.getElementById("textline").innerHTML += '<input class="textbox" id="textbox' + blankindex + '" style="width:calc(1.4vmax * ' + tbl + ');" maxlength="' + tbl + '" autocomplete="off" onkeypress="return event.key != \' \'"></input> ';
            }
            blankindex++;
        }
        else{
            document.getElementById("textline").innerHTML += w[c][i] + ' ';
        }
    }
}

function flip(n, b, w){
    for(let i = 0; i < n.length; i++){
        n[i] = w[i].length - n[i];
    }
    for(let i = 0; i < b.length; i++){
        for(let j = 0; j < b[i].length; j++){
            if(b[i][j] == 1){
                b[i][j] = 0;
            }
            else{
                b[i][j] = 1;
            }
        }
    }
    
}

function nextphr(b){
    SessionCompletedSentences++;
    if(b==0){
        Failed++;
        //disabledSentences[phr_index]++;
        document.getElementById("phr-input").classList.remove("wrong");
    }
    else{
        Successful++;
        //disabledSentences[phr_index]--;
    }
    var alldone = disabledSentences.every(v => {return v===0});
    if(alldone){
        GoBack();
        return;
    }
    do {
        phr_index++;
        if(phr_index == list.length){
            phr_index = 0;
            session++;
            shuffle(list, disabledSentences);
            SessionCompletedSentences = 0;
        }
    }
    while(disabledSentences[phr_index] == 0);
    var TotalPhrases = remainingsentences(phr_index) + SessionCompletedSentences;
    document.getElementById("phr").innerHTML = list[phr_index][0];
    document.getElementById("phr-input").value = "";
    document.getElementById("session").innerHTML = 'Session:' + session + ' &nbsp Completed:' + SessionCompletedSentences + '/' + TotalPhrases;
    
    if(Successful + Failed === 0)
        document.getElementById("rates").innerHTML = 'Rates: 0.00%';
    else
        document.getElementById("rates").innerHTML = 'Rates: ' + (Successful * 100 / (Successful + Failed)).toFixed(2) + '%';
}

function phr_check(){
    var val = document.getElementById("phr-input").value;
    if(val == list[phr_index][1] && !phr_shownanswer){
        nextphr(1);
    }
    else if(val[val.length-1]=='\n' && !phr_shownanswer){
        phr_shownanswer = true;
        document.getElementById("phr-input").value = list[phr_index][1];
        document.getElementById("phr-input").classList.add("wrong");
    }
    else if(val[val.length-1]=='\n' && phr_shownanswer){
        phr_shownanswer = false;
        nextphr(0);
    }
}

function makecheckbox(s, n, b){
    return '<input type="checkbox" id="configcheck' + n + '" name="configcheck' + n + '" onchange="checkboxchange(this, ' + n + ')"' + (b > 0 ? 'checked' : '') + '><label for="configcheck' + n + '"> '+ s + '</label>';
}

function checkboxchange(c, n){
    if(c.checked == false){
        disabledSentences[n] = 0;
    }
    else {
        disabledSentences[n] = llist;
    }
    if(document.getElementById("refreshbutton").classList.contains("hide"))
        document.getElementById("refreshbutton").classList.remove("hide");
}

function endofsentence(){
    CurrentSentence = 0;
    if(mode === 0){
        mode = 1;
        flip(NofBlanks, BlanksPosition, WordsInSentences);
        BlankWords = [];
        for(let i = 0; i < NofBlanks.length; i++){
            var sbw = [];
            for(let j = 0; j < WordsInSentences[i].length; j++){
                if(BlanksPosition[i][j] == 1){
                    sbw.push([WordsInSentences[i][j], j]);
                }
            }
            BlankWords.push(sbw);
        }
    }
    else{
        mode = 0;
        NofBlanks = [];
        BlanksPosition = [];
        WordsInSentences = [];
        BlankWords = [];
        init(sentences, NofBlanks, BlanksPosition, WordsInSentences, BlankWords);
        session++;
        SessionCompletedBlanks = 0;
        SessionCompletedSentences = 0;
    }
}

function remainingblanks(){
    var BlL = BlankWords[CurrentSentence].length - CurrentBlank;
    for(var i = CurrentSentence + 1; i < sentences.length; i++){
        if(disabledSentences[i] > 0)
            BlL+=BlankWords[i].length;
    }
    if(mode === 0){
        var fsessionblanks = 0;
        for(var i = 0; i < NofBlanks.length; i++){
            if(disabledSentences[i] > 0)
                fsessionblanks += WordsInSentences[i].length - NofBlanks[i];
        }
        BlL += fsessionblanks;
    }
    return BlL;
}

function remainingsentences(c){
    var SeL = 0;
    for(var i = c; i < disabledSentences.length; i++){
        if(disabledSentences[i] > 0) SeL++;
    }
    if(mode == 0 && Page != "m" && Page != "p"){
        for(var i = 0; i < disabledSentences.length; i++) {
            if(disabledSentences[i] > 0) SeL++;
        }
    }
    return SeL;
}

function refreshpage(){
    if(Page!="p"){
        mode = 0;
        NofBlanks = [];
        BlanksPosition = [];
        WordsInSentences = [];
        BlankWords = [];
        init(sentences, NofBlanks, BlanksPosition, WordsInSentences, BlankWords);
        SessionCompletedBlanks = 0;
        SessionCompletedSentences = 0;
        CurrentSentence = 0;
        while(disabledSentences[CurrentSentence] == 0){
            CurrentSentence++;
        }
        display(WordsInSentences, BlanksPosition, CurrentSentence);
        document.getElementById("session").innerHTML = 'Session:' + session + ' &nbsp Blanks Filled In:0/' + remainingblanks() + ' &nbsp Sentences Completed:0/' + remainingsentences(CurrentSentence);
    }
    else{
        phr_index = 0;
        shuffle(list, disabledSentences);
        SessionCompletedSentences = 0;
        while(disabledSentences[phr_index] == 0){
            phr_index++;
        }
        document.getElementById("phr").innerHTML = list[0][0];
        document.getElementById("session").innerHTML = 'Session:' + session + ' &nbsp Completed:0/' + remainingsentences(phr_index);
    }
    document.getElementById("refreshbutton").classList.add("hide");
}

document.addEventListener("keyup", (k) => {
    if(Page=="sv" || Page=="sm" || Page=="sp"){
        var bcclen = BlankWords[CurrentSentence][CurrentBlank][0].length;
        var lastchar = BlankWords[CurrentSentence][CurrentBlank][0][bcclen - 1];
        if(k.code==='Tab' || k.code === 'Enter'){
            var bcc0 = BlankWords[CurrentSentence][CurrentBlank][0];
            if(PMarks.includes(lastchar)) bcc0 = bcc0.substring(0, bcclen - 1);
            document.getElementById("textbox" + CurrentBlank).value = bcc0;
            document.getElementById("textbox" + CurrentBlank).classList.add("wrong");
            Failed++;
            Successful--;
        }
        var CurrentBlankValue=document.getElementById("textbox" + CurrentBlank).value;
        if(PMarks.includes(lastchar)) CurrentBlankValue += lastchar;
        if(CurrentBlankValue === BlankWords[CurrentSentence][CurrentBlank][0] && (!document.getElementById("textbox" + CurrentBlank).classList.contains("wrong") || (k.code==='Tab' || k.code === 'Enter'))){
            Successful++;
            SessionCompletedBlanks++;
            if((CurrentBlank !== BlankWords[CurrentSentence].length - 1) || (enterskip === 1 && k.code === 'Enter') || (enterskip === 0 && k.code !== 'Enter'))
                {CurrentBlank++; enterskip2 = 0;}
            else {enterskip2 = 1; SessionCompletedBlanks--;}
            if(CurrentBlank === BlankWords[CurrentSentence].length){
                if ((enterskip === 0 && k.code !== 'Enter') || (enterskip === 1 && k.code === 'Enter')){
                    CurrentBlank = 0;
                    SessionCompletedSentences++;
                    if(!document.getElementById("refreshbutton").classList.contains("hide"))
                        document.getElementById("refreshbutton").classList.add("hide");
                    do{
                        CurrentSentence++;
                        if(CurrentSentence === sentences.length){
                            endofsentence();
                        }
                    }
                    while(disabledSentences[CurrentSentence] == 0);
                    if(enterskip === 1 && k.code === 'Enter'){
                        enterskip = 0;
                        Failed--;
                    }
                }
                display(WordsInSentences, BlanksPosition, CurrentSentence);
            }
            document.getElementById("textbox" + CurrentBlank).focus();
        }

        if(k.code==='Enter' && enterskip === 0 && enterskip2 === 1){
            enterskip = 1;
            enterskip2 = 0;
        }
        var TotalBlanks = remainingblanks() + SessionCompletedBlanks;
        var TotalSentences = remainingsentences(CurrentSentence) + SessionCompletedSentences;
        if(Successful + Failed === 0)
            document.getElementById("rates").innerHTML = 'Rates: 0.00%';
        else
            document.getElementById("rates").innerHTML = 'Rates: ' + (Successful * 100 / (Successful + Failed)).toFixed(2) + '%';
        document.getElementById("session").innerHTML = 'Session:' + session + ' &nbsp Blanks Filled In:' + SessionCompletedBlanks + '/' + TotalBlanks + ' &nbsp Sentences Completed:' + SessionCompletedSentences + '/' + TotalSentences;
    }
})

document.querySelector("#UI").innerHTML = menu_html;
showinfo();